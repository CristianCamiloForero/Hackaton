<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simulador Robot de Almacén</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <!-- Hero Section -->
    <div class="hero">
      <svg class="hero-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="5" y="4" width="14" height="16" rx="2" stroke="#2563eb" stroke-width="2"/>
        <circle cx="12" cy="9" r="2" fill="#2563eb"/>
        <path d="M9 14h6M9 17h4" stroke="#2563eb" stroke-width="2" stroke-linecap="round"/>
        <path d="M5 6L3 8v8l2 2M19 6l2 2v8l-2 2" stroke="#2563eb" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <h1>Simulador Robot de Almacén</h1>
      <p>Optimiza la recolección de paquetes con algoritmos inteligentes</p>
    </div>

    <!-- Main Card -->
    <div class="main-card">
      <!-- CTA Section -->
      <div class="cta-section" id="ctaSection">
        <h2>Simula tu Recolección</h2>
        <p>Configura las ubicaciones de los paquetes y descubre la ruta óptima para tu robot recolector</p>
        <button id="startBtn" class="btn-primary">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M13 2L3 14h8l-1 8 10-12h-8l1-8z" fill="currentColor"/>
          </svg>
          Iniciar Simulación
        </button>
      </div>

      <!-- Form Section -->
      <div class="form-section" id="formSection">
        <div class="form-header">
          <h3>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
              <circle cx="12" cy="12" r="9" stroke="#2563eb" stroke-width="2"/>
              <path d="M12 6v6l4 2" stroke="#2563eb" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Configuración de Paquetes
          </h3>
          <button id="loadDefaultsBtn" class="btn-secondary">Cargar Ejemplo</button>
        </div>

        <!-- Mode Tabs: Simple vs Consolidation -->
        <div class="mode-tabs">
          <button class="mode-tab active" data-mode="simple">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
            </svg>
            Simulación Simple
          </button>
          <!-- Consolidación de órdenes (removida UI de JSON para usuarios normales) -->
          <button class="mode-tab" data-mode="cycle">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2v6l4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M21 12a9 9 0 11-9-9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Conteo Cíclico
          </button>
        </div>
        <div class="tabs-container">
          <div class="tabs-header" id="tabsHeader">
            <button class="tab-button active" data-tab="0">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
              </svg>
              Paquete 1
            </button>
          </div>
          <button class="add-tab-btn" id="addTabBtn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Agregar Paquete
          </button>
        </div>

        <!-- Tab Content -->
        <div class="tabs-content" id="tabsContent">
          <div class="tab-pane active" data-pane="0">
            <div class="form-grid">
              <div class="form-group">
                <label>
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                    <path d="M12 5v14M5 12h14" stroke="#2563eb" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  Fila
                  <div class="label-description">Coordenada vertical del paquete</div>
                </label>
                <input type="number" class="package-row" data-index="0" value="0" min="0" />
              </div>

              <div class="form-group">
                <label>
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                    <path d="M12 5v14M5 12h14" stroke="#2563eb" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  Columna
                  <div class="label-description">Coordenada horizontal del paquete</div>
                </label>
                <input type="number" class="package-col" data-index="0" value="0" min="0" />
              </div>
            </div>

            <div class="tab-actions">
              <button type="button" class="btn-danger remove-tab-btn" data-index="0">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Eliminar Paquete
              </button>
            </div>
          </div>
        </div>

        <!-- Package Summary -->
        <div class="package-summary" id="packageSummary">
          <div class="summary-title">Resumen de Paquetes</div>
          <div class="summary-list" id="summaryList"></div>
        </div>

        <!-- Consolidación de órdenes: UI JSON removida (mejorar con formulario si se requiere) -->

        <!-- Cycle Count Section (Hidden by default) -->
        <div id="cycleSection" style="display: none; margin-bottom: 24px;">
          <div class="consolidate-info">
            <h4>Conteo Cíclico Prioritario</h4>
            <p>Agrega ubicaciones de forma sencilla: ingresa SKU, <strong>Cantidad</strong> y ubicación (fila/col). Al generar el plan verás un resumen con el inventario total y cuántas unidades salieron (movimientos).</p>
            <div class="cycle-form" style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
              <input id="inputSKU" placeholder="SKU" style="padding:6px; width:120px;" />
              <input id="inputCantidad" type="number" placeholder="Cantidad" style="padding:6px; width:110px;" min="0" />
              <input id="inputFila" type="number" placeholder="Fila" style="padding:6px; width:80px;" min="1" max="12" />
              <input id="inputCol" type="number" placeholder="Col" style="padding:6px; width:80px;" min="1" max="9" />
              <input id="inputMov" type="number" placeholder="Movimientos" style="padding:6px; width:110px;" />
              <input id="inputConteos" type="number" placeholder="Conteos ult.365" style="padding:6px; width:140px;" />
              <input id="inputCrit" type="number" placeholder="Criticidad (1-5)" style="padding:6px; width:120px;" />
              <button id="addCycleRowBtn" type="button" class="btn-secondary">Agregar</button>
              <button id="clearCycleBtn" type="button" class="btn-secondary">Limpiar</button>
            </div>
            <div style="margin-top:8px;">
              <button id="loadCycleDefaultsBtn" type="button" class="btn-secondary">Cargar Ejemplo</button>
              <button id="loadInventoryBtn" type="button" class="btn-secondary">Cargar Inventario Quemado</button>
            </div>

            <div style="margin-top:12px; overflow:auto;">
              <table id="cycleTable" class="cycle-table-input" style="width:100%; border-collapse:collapse;">
                <thead>
                  <tr>
                    <th>SKU</th><th>Cantidad</th><th>Fila</th><th>Col</th><th>Mov</th><th>Conteos</th><th>Crit</th><th></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

            <div style="display:flex; gap:8px; margin-top:8px; align-items:center; flex-wrap:wrap;">
              <label style="display:flex; gap:6px; align-items:center;">Frecuencia mínima
                <input id="cycleFreqInput" type="number" value="5" min="1" style="width:80px; padding:6px;" />
              </label>
              <label style="display:flex; gap:6px; align-items:center;">Peso faltantes
                <input id="weightFaltantes" type="number" value="100" style="width:100px; padding:6px;" />
              </label>
              <label style="display:flex; gap:6px; align-items:center;">Peso movimientos
                <input id="weightMovimientos" type="number" value="1" style="width:80px; padding:6px;" />
              </label>
              <label style="display:flex; gap:6px; align-items:center;">Peso criticidad
                <input id="weightCriticidad" type="number" value="50" style="width:80px; padding:6px;" />
              </label>
              <button id="loadCycleDefaultsBtn" type="button" class="btn-secondary">Cargar Ejemplo</button>
              <button id="runCycleBtn" type="button" class="btn-success">Generar Plan</button>
            </div>
          </div>
          <div id="cycleResults" style="margin-top:12px;"></div>
        </div>

        <form id="simulationForm">
          <div class="form-actions">
            <button type="button" id="cancelBtn" class="btn-secondary">Cancelar</button>
            <button type="submit" id="runBtn" class="btn-success">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M5 3l14 9-14 9V3z" fill="currentColor"/>
              </svg>
              Ejecutar Simulación
            </button>
          </div>
        </form>
      </div>

      <!-- Results Section -->
      <div class="results-section" id="resultsSection">
        <div class="results-header">
          <h3>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
              <circle cx="12" cy="12" r="10" fill="#10b981"/>
              <path d="M8 12l2 2 4-4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Resultados de la Simulación
          </h3>
          <button id="backToFormBtn" class="btn-secondary">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 12H5M12 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Nueva Simulación
          </button>
        </div>

        <div class="result-card">
          <div class="result-stats" id="resultStats"></div>
        </div>

        <!-- Warehouse Grid -->
        <div class="warehouse-container">
          <div class="warehouse-header">
            <span class="warehouse-title">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                <rect x="3" y="3" width="18" height="18" rx="2" stroke="#2563eb" stroke-width="2"/>
                <path d="M3 9h18M9 3v18" stroke="#2563eb" stroke-width="2"/>
              </svg>
              Visualización del Almacén
            </span>
            <div class="warehouse-legend">
              <span class="legend-item"><span class="legend-color" style="background: #3b82f6; border: 1px solid #1e40af;"></span> Audio</span>
              <span class="legend-item"><span class="legend-color" style="background: #10b981; border: 1px solid #047857;"></span> Cómputo</span>
              <span class="legend-item"><span class="legend-color" style="background: #ef4444; border: 1px solid #dc2626;"></span> Refrigeración</span>
              <span class="legend-item"><span class="legend-color" style="background: #8b5cf6; border: 1px solid #6d28d9;"></span> Aire Acondicionado</span>
              <br/>
              <span class="legend-item"><span class="legend-color" style="background: #fef3c7; border: 1px solid #fbbf24;"></span> Pasillos</span>
              <span class="legend-item"><span class="legend-color" style="background: #10b981;"></span> Inicio</span>
              <span class="legend-item"><span class="legend-color" style="background: #f59e0b;"></span> Paquetes</span>
              <span class="legend-item"><span class="legend-color" style="background: #ef4444;"></span> Final</span>
            </div>
          </div>
          <div style="overflow-x: auto; overflow-y: visible; width: 100%;">
            <div id="warehouseGrid"></div>
          </div>
          <!-- Path Legend -->
          <div class="path-legend" id="pathLegend" style="margin-top: 16px; padding: 12px; background: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb;">
            <div style="font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2v6l4-4" stroke="#2563eb" stroke-width="2" stroke-linecap="round"/>
                <path d="M4 12h8v8H4z" fill="#6366f1" opacity="0.2"/>
              </svg>
              <span>Ruta del Robot</span>
            </div>
            <div style="display: flex; gap: 24px; flex-wrap: wrap; font-size: 13px;">
              <span class="legend-item" style="display: flex; align-items: center; gap: 6px;">
                <svg width="16" height="16" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="12" cy="12" r="8" fill="#10b981"/>
                </svg>
                <span>Punto de inicio</span>
              </span>
              <span class="legend-item" style="display: flex; align-items: center; gap: 6px;">
                <svg width="16" height="16" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="12" cy="12" r="8" fill="#6366f1"/>
                </svg>
                <span>Punto intermedio (numerado)</span>
              </span>
              <span class="legend-item" style="display: flex; align-items: center; gap: 6px;">
                <svg width="16" height="16" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="12" cy="12" r="8" fill="#ef4444"/>
                </svg>
                <span>Punto de llegada</span>
              </span>
              <span class="legend-item" style="display: flex; align-items: center; gap: 6px;">
                <svg width="16" height="16" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <line x1="2" y1="12" x2="14" y2="12" stroke="#6366f1" stroke-width="2"/>
                  <polygon points="16,12 12,10 12,14" fill="#6366f1"/>
                </svg>
                <span>Línea de dirección (con flecha)</span>
              </span>
            </div>
          </div>
        </div>

        <div class="table-container">
          <div class="table-header">
            <span class="table-title">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                <rect x="3" y="3" width="18" height="18" rx="2" stroke="#2563eb" stroke-width="2"/>
                <path d="M3 9h18M9 3v18" stroke="#2563eb" stroke-width="2"/>
              </svg>
              Detalle de Movimientos
            </span>
            <button id="exportBtn" class="btn-export" disabled>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 3v12m0 0l-4-4m4 4l4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M3 17v2a2 2 0 002 2h14a2 2 0 002-2v-2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Exportar a Excel
            </button>
          </div>
          <div id="tableArea"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification">
    <svg id="notificationIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="12" cy="12" r="10" fill="#10b981"/>
      <path d="M8 12l2 2 4-4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    <span id="notificationText"></span>
  </div>

  <script src="app.js"></script>
</body>
</html>