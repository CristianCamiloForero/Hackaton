<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot Recolector de Almac√©n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .section {
            display: flex;
            flex-direction: column;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .grid-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            background: #f5f5f5;
            border-radius: 8px;
            padding: 20px;
            min-height: 500px;
        }

        canvas {
            border: 2px solid #667eea;
            background: white;
            border-radius: 4px;
        }

        .info-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .info-item {
            background: #f9f9f9;
            padding: 15px;
            border-left: 4px solid #667eea;
            border-radius: 4px;
        }

        .info-label {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .info-value {
            color: #333;
            font-size: 1.1em;
        }

        .log-section {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .log-item {
            padding: 8px;
            margin-bottom: 8px;
            background: white;
            border-left: 3px solid #667eea;
            border-radius: 2px;
            font-size: 0.9em;
            color: #333;
        }

        .log-header {
            font-weight: bold;
            color: white;
            background: #667eea;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
        }

        .controls {
            grid-column: 1 / -1;
            display: flex;
            gap: 15px;
            justify-content: center;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        button {
            padding: 12px 30px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-run {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-run:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-reset {
            background: #f0f0f0;
            color: #333;
            border: 2px solid #667eea;
        }

        .btn-reset:hover {
            background: #e0e0e0;
        }

        .results {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            text-align: center;
            margin-top: 20px;
        }

        .result-item h3 {
            font-size: 0.9em;
            font-weight: normal;
            margin-bottom: 8px;
            opacity: 0.9;
        }

        .result-item .value {
            font-size: 2em;
            font-weight: bold;
        }

        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 15px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-box {
            width: 20px;
            height: 20px;
            border-radius: 2px;
        }

        @media (max-width: 1024px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ ROBOT RECOLECTOR DE ALMAC√âN</h1>
            <p>Simulaci√≥n de optimizaci√≥n de rutas y c√°lculo de costos</p>
        </div>

        <div class="content">
            <div class="section">
                <h2>Visualizaci√≥n del Almac√©n</h2>
                <div class="grid-container">
                    <canvas id="warehouseCanvas"></canvas>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #4CAF50;"></div>
                        <span>Inicio/Final</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FF6B6B;"></div>
                        <span>Paquete</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #FFD93D;"></div>
                        <span>Pasillo</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #2196F3;"></div>
                        <span>Ruta del Robot</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Informaci√≥n de la Simulaci√≥n</h2>
                <div class="info-panel">
                    <div class="info-item">
                        <div class="info-label">Posici√≥n Inicial</div>
                        <div class="info-value" id="initialPos">Calculando...</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Posici√≥n Actual del Robot</div>
                        <div class="info-value" id="currentPos">Calculando...</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Total de Paquetes</div>
                        <div class="info-value" id="totalPackages">Calculando...</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Costo Unitario por Celda</div>
                        <div class="info-value" id="costPerCell">Calculando...</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Costo Unitario por Pasillo</div>
                        <div class="info-value" id="costPerAisle">Calculando...</div>
                    </div>
                </div>
            </div>

            <div class="section" style="grid-column: 1 / -1;">
                <h2>Registro de Movimientos</h2>
                <div class="log-section">
                    <div class="log-header">Historial de Acciones</div>
                    <div id="logContainer"></div>
                </div>
            </div>

            <div class="controls">
                <button class="btn-run" onclick="runSimulation()">Ejecutar Simulaci√≥n</button>
                <button class="btn-reset" onclick="resetSimulation()">Reiniciar</button>
            </div>

            <div class="results" id="resultsPanel" style="display: none;">
                <div class="result-item">
                    <h3>Costo Total</h3>
                    <div class="value" id="totalCost">0.00</div>
                </div>
                <div class="result-item">
                    <h3>Paquetes Recogidos</h3>
                    <div class="value" id="packagesCollected">0</div>
                </div>
                <div class="result-item">
                    <h3>Posici√≥n Final</h3>
                    <div class="value" id="finalPos">(0, 0)</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables del almac√©n
        const FILAS = 9;
        const COLUMNAS = 12;
        const PASILLOS = [1, 4, 7, 10];
        const PAQUETES = [[2,0], [6,3], [0,5], [3,6], [4,8], [1,9], [6,11]];
        const INICIO = [0, 0];
        const COSTO_CELDA = 2.7;
        const COSTO_PASILLO = 5.0;

        // Estado del robot
        let fila_actual = INICIO[0];
        let col_actual = INICIO[1];
        let costo_total = 0;
        let log = [];
        let ruta = [];

        // Configuraci√≥n del canvas
        const canvas = document.getElementById('warehouseCanvas');
        const ctx = canvas.getContext('2d');
        const CELL_SIZE = 40;
        const MARGIN = 30;

        canvas.width = COLUMNAS * CELL_SIZE + 2 * MARGIN;
        canvas.height = FILAS * CELL_SIZE + 2 * MARGIN;

        // Inicializar informaci√≥n
        document.getElementById('initialPos').textContent = `(${INICIO[0]}, ${INICIO[1]})`;
        document.getElementById('totalPackages').textContent = PAQUETES.length;
        document.getElementById('costPerCell').textContent = COSTO_CELDA.toFixed(2);
        document.getElementById('costPerAisle').textContent = COSTO_PASILLO.toFixed(2);

        function calcular_costo(fila1, col1, fila2, col2) {
            let costo = 0;

            // Movimiento vertical
            const pasos_verticales = Math.abs(fila2 - fila1);
            costo += pasos_verticales * COSTO_CELDA;

            // Movimiento horizontal
            for (let c = Math.min(col1, col2); c < Math.max(col1, col2); c++) {
                if (PASILLOS.includes(c + 1)) {
                    costo += COSTO_PASILLO;
                } else {
                    costo += COSTO_CELDA;
                }
            }

            return costo;
        }

        function addLog(message) {
            log.push(message);
            updateLogDisplay();
        }

        function updateLogDisplay() {
            const logContainer = document.getElementById('logContainer');
            logContainer.innerHTML = log.map(item => `<div class="log-item">${item}</div>`).join('');
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function drawWarehouse() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Dibujar grid
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            for (let i = 0; i <= FILAS; i++) {
                ctx.beginPath();
                ctx.moveTo(MARGIN, MARGIN + i * CELL_SIZE);
                ctx.lineTo(MARGIN + COLUMNAS * CELL_SIZE, MARGIN + i * CELL_SIZE);
                ctx.stroke();
            }
            for (let j = 0; j <= COLUMNAS; j++) {
                ctx.beginPath();
                ctx.moveTo(MARGIN + j * CELL_SIZE, MARGIN);
                ctx.lineTo(MARGIN + j * CELL_SIZE, MARGIN + FILAS * CELL_SIZE);
                ctx.stroke();
            }

            // Dibujar pasillos
            ctx.fillStyle = '#FFD93D';
            ctx.globalAlpha = 0.3;
            for (let pasillo of PASILLOS) {
                ctx.fillRect(
                    MARGIN + (pasillo - 1) * CELL_SIZE,
                    MARGIN,
                    CELL_SIZE,
                    FILAS * CELL_SIZE
                );
            }
            ctx.globalAlpha = 1.0;

            // Dibujar ruta
            if (ruta.length > 0) {
                ctx.strokeStyle = '#2196F3';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(
                    MARGIN + ruta[0][1] * CELL_SIZE + CELL_SIZE / 2,
                    MARGIN + ruta[0][0] * CELL_SIZE + CELL_SIZE / 2
                );
                for (let i = 1; i < ruta.length; i++) {
                    ctx.lineTo(
                        MARGIN + ruta[i][1] * CELL_SIZE + CELL_SIZE / 2,
                        MARGIN + ruta[i][0] * CELL_SIZE + CELL_SIZE / 2
                    );
                }
                ctx.stroke();
            }

            // Dibujar paquetes
            ctx.fillStyle = '#FF6B6B';
            for (let paq of PAQUETES) {
                ctx.fillRect(
                    MARGIN + paq[1] * CELL_SIZE + 5,
                    MARGIN + paq[0] * CELL_SIZE + 5,
                    CELL_SIZE - 10,
                    CELL_SIZE - 10
                );
            }

            // Dibujar inicio
            ctx.fillStyle = '#4CAF50';
            ctx.fillRect(
                MARGIN + INICIO[1] * CELL_SIZE + 3,
                MARGIN + INICIO[0] * CELL_SIZE + 3,
                CELL_SIZE - 6,
                CELL_SIZE - 6
            );
            ctx.strokeStyle = '#2E7D32';
            ctx.lineWidth = 2;
            ctx.strokeRect(
                MARGIN + INICIO[1] * CELL_SIZE + 3,
                MARGIN + INICIO[0] * CELL_SIZE + 3,
                CELL_SIZE - 6,
                CELL_SIZE - 6
            );

            // Dibujar robot actual
            ctx.fillStyle = '#FF9800';
            ctx.beginPath();
            ctx.arc(
                MARGIN + col_actual * CELL_SIZE + CELL_SIZE / 2,
                MARGIN + fila_actual * CELL_SIZE + CELL_SIZE / 2,
                CELL_SIZE / 2 - 5,
                0,
                2 * Math.PI
            );
            ctx.fill();
            ctx.strokeStyle = '#E65100';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function runSimulation() {
            // Reset
            fila_actual = INICIO[0];
            col_actual = INICIO[1];
            costo_total = 0;
            log = [];
            ruta = [];

            addLog('üöÄ Iniciando simulaci√≥n...');
            ruta.push([fila_actual, col_actual]);

            // Organizar paquetes por columna
            const paquetes_por_columna = {};
            for (let paq of PAQUETES) {
                const [fila, col] = paq;
                if (!paquetes_por_columna[col]) {
                    paquetes_por_columna[col] = [];
                }
                paquetes_por_columna[col].push(fila);
            }

            // Ordenar las filas en cada columna
            for (let col in paquetes_por_columna) {
                paquetes_por_columna[col].sort((a, b) => a - b);
            }

            // Obtener columnas ordenadas
            const columnas = Object.keys(paquetes_por_columna).map(Number).sort((a, b) => a - b);

            // Procesar cada columna
            for (let col of columnas) {
                addLog(`<strong>üìç Columna ${col}</strong>`);
                const filas_con_paquetes = paquetes_por_columna[col];

                // Decidir por d√≥nde entrar
                const dist_arriba = Math.abs(fila_actual - 0);
                const dist_abajo = Math.abs(fila_actual - 8);

                let entrada, salida;
                if (dist_arriba <= dist_abajo) {
                    entrada = 0;
                    salida = 8;
                    addLog('  ‚Üì Entrando por arriba');
                } else {
                    entrada = 8;
                    salida = 0;
                    addLog('  ‚Üë Entrando por abajo');
                }

                // Moverse a la columna
                if (col !== col_actual) {
                    const costo = calcular_costo(fila_actual, col_actual, fila_actual, col);
                    costo_total += costo;
                    addLog(`  ‚Üí Ir a columna ${col}: costo ${costo.toFixed(2)}`);
                    col_actual = col;
                    ruta.push([fila_actual, col_actual]);
                }

                // Ir a la entrada
                if (fila_actual !== entrada) {
                    const costo = calcular_costo(fila_actual, col_actual, entrada, col_actual);
                    costo_total += costo;
                    addLog(`  ‚Üï Ir a fila ${entrada}: costo ${costo.toFixed(2)}`);
                    fila_actual = entrada;
                    ruta.push([fila_actual, col_actual]);
                }

                // Recoger cada paquete
                for (let i = 0; i < filas_con_paquetes.length; i++) {
                    const fila_paq = filas_con_paquetes[i];
                    if (fila_actual !== fila_paq) {
                        const costo = calcular_costo(fila_actual, col_actual, fila_paq, col_actual);
                        costo_total += costo;
                        addLog(`  üì¶ Recoger paquete ${i + 1} en fila ${fila_paq}: costo ${costo.toFixed(2)}`);
                        fila_actual = fila_paq;
                        ruta.push([fila_actual, col_actual]);
                    }
                }

                // Ir a la salida
                if (fila_actual !== salida) {
                    const costo = calcular_costo(fila_actual, col_actual, salida, col_actual);
                    costo_total += costo;
                    addLog(`  ‚Üï Ir a fila ${salida}: costo ${costo.toFixed(2)}`);
                    fila_actual = salida;
                    ruta.push([fila_actual, col_actual]);
                }
            }

            // Resultado final
            addLog('<strong>‚úÖ Simulaci√≥n completada</strong>');

            document.getElementById('currentPos').textContent = `(${fila_actual}, ${col_actual})`;
            document.getElementById('totalCost').textContent = costo_total.toFixed(2);
            document.getElementById('packagesCollected').textContent = PAQUETES.length;
            document.getElementById('finalPos').textContent = `(${fila_actual}, ${col_actual})`;
            document.getElementById('resultsPanel').style.display = 'grid';

            drawWarehouse();
        }

        function resetSimulation() {
            fila_actual = INICIO[0];
            col_actual = INICIO[1];
            costo_total = 0;
            log = [];
            ruta = [];

            document.getElementById('currentPos').textContent = `(${INICIO[0]}, ${INICIO[1]})`;
            document.getElementById('logContainer').innerHTML = '';
            document.getElementById('resultsPanel').style.display = 'none';

            drawWarehouse();
        }

        // Dibujar almac√©n inicial
        drawWarehouse();
    </script>
</body>
</html>
